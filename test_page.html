<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Hearthlink IPC Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #0056b3;
        }
        .result {
            margin: 10px 0;
            padding: 10px;
            background: #e9ecef;
            border-radius: 4px;
            white-space: pre-wrap;
        }
        .success {
            background: #d4edda;
            color: #155724;
        }
        .error {
            background: #f8d7da;
            color: #721c24;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Hearthlink IPC Integration Test</h1>
        
        <div class="test-section">
            <h2>1. API Availability Test</h2>
            <button onclick="testAPIAvailability()">Test API Availability</button>
            <div id="api-result" class="result"></div>
        </div>

        <div class="test-section">
            <h2>2. Voice Command Test</h2>
            <button onclick="testVoiceCommand()">Test Voice Command</button>
            <div id="voice-result" class="result"></div>
        </div>

        <div class="test-section">
            <h2>3. Core Session Test</h2>
            <button onclick="testCoreSession()">Test Core Session</button>
            <div id="session-result" class="result"></div>
        </div>

        <div class="test-section">
            <h2>4. Synapse Plugin Test</h2>
            <button onclick="testSynapsePlugins()">Test Synapse Plugins</button>
            <div id="synapse-result" class="result"></div>
        </div>

        <div class="test-section">
            <h2>5. Vault Memory Test</h2>
            <button onclick="testVaultMemory()">Test Vault Memory</button>
            <div id="vault-result" class="result"></div>
        </div>
    </div>

    <script>
        function showResult(elementId, message, isSuccess = true) {
            const element = document.getElementById(elementId);
            element.textContent = message;
            element.className = `result ${isSuccess ? 'success' : 'error'}`;
        }

        function testAPIAvailability() {
            const apiMethods = [
                'sendVoiceCommand',
                'createSession',
                'getSession',
                'addParticipant',
                'startTurnTaking',
                'advanceTurn',
                'getPersonaMemory',
                'updatePersonaMemory',
                'executePlugin',
                'listPlugins'
            ];

            if (window.electronAPI) {
                const available = apiMethods.filter(method => typeof window.electronAPI[method] === 'function');
                const missing = apiMethods.filter(method => typeof window.electronAPI[method] !== 'function');
                
                let result = `✓ Electron API available!\n`;
                result += `Available methods: ${available.join(', ')}\n`;
                if (missing.length > 0) {
                    result += `Missing methods: ${missing.join(', ')}`;
                }
                
                showResult('api-result', result, missing.length === 0);
            } else {
                showResult('api-result', '✗ Electron API not available', false);
            }
        }

        async function testVoiceCommand() {
            try {
                if (!window.electronAPI) {
                    throw new Error('Electron API not available');
                }
                
                const response = await window.electronAPI.sendVoiceCommand('Hello from IPC test');
                showResult('voice-result', `✓ Voice command successful!\nResponse: ${JSON.stringify(response, null, 2)}`);
            } catch (error) {
                showResult('voice-result', `✗ Voice command failed: ${error.message}`, false);
            }
        }

        async function testCoreSession() {
            try {
                if (!window.electronAPI) {
                    throw new Error('Electron API not available');
                }
                
                const sessionResponse = await window.electronAPI.createSession(
                    'test-user-001',
                    'Test Conference Session',
                    [
                        { id: 'alden', name: 'Alden', type: 'persona', role: 'Executive Function' },
                        { id: 'alice', name: 'Alice', type: 'persona', role: 'Behavioral Analysis' }
                    ]
                );
                
                if (sessionResponse.success) {
                    const sessionId = sessionResponse.data.sessionId;
                    const getResponse = await window.electronAPI.getSession(sessionId);
                    
                    let result = `✓ Core session tests successful!\n`;
                    result += `Session created: ${sessionId}\n`;
                    result += `Session details: ${JSON.stringify(getResponse.data, null, 2)}`;
                    
                    showResult('session-result', result);
                } else {
                    throw new Error(sessionResponse.error);
                }
            } catch (error) {
                showResult('session-result', `✗ Core session test failed: ${error.message}`, false);
            }
        }

        async function testSynapsePlugins() {
            try {
                if (!window.electronAPI) {
                    throw new Error('Electron API not available');
                }
                
                const response = await window.electronAPI.listPlugins();
                showResult('synapse-result', `✓ Synapse plugin test successful!\nPlugins: ${JSON.stringify(response.data, null, 2)}`);
            } catch (error) {
                showResult('synapse-result', `✗ Synapse plugin test failed: ${error.message}`, false);
            }
        }

        async function testVaultMemory() {
            try {
                if (!window.electronAPI) {
                    throw new Error('Electron API not available');
                }
                
                const getResponse = await window.electronAPI.getPersonaMemory('alden', 'test-user-001');
                
                let result = `✓ Vault memory test successful!\n`;
                result += `Memory retrieved: ${JSON.stringify(getResponse.data, null, 2)}`;
                
                showResult('vault-result', result);
            } catch (error) {
                showResult('vault-result', `✗ Vault memory test failed: ${error.message}`, false);
            }
        }

        // Auto-run API availability test on load
        window.addEventListener('DOMContentLoaded', () => {
            testAPIAvailability();
        });
    </script>
</body>
</html>